<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	<!-- 2019 Jan -->
	<select id="selectJanValue" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		FROM MEMBER
		WHERE TO_CHAR(M_REGDATE,'YYYYMMDD')
		BETWEEN '20190101' AND '20190131'
	]]>
	</select>
	<select id="selectFebValue" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		FROM MEMBER
		WHERE TO_CHAR(M_REGDATE,'YYYYMMDD')
		BETWEEN '20190201' AND '20190230'
	]]>
	</select>
	<select id="selectDecValue" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		FROM MEMBER
		WHERE TO_CHAR(M_REGDATE,'YYYYMMDD')
		BETWEEN '20181201' AND '20181231'
	]]>
	</select>
	<select id="selectNovValue" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		FROM MEMBER
		WHERE TO_CHAR(M_REGDATE,'YYYYMMDD')
		BETWEEN '20181101' AND '20181130'
	]]>
	</select>
	<select id="selectOctValue" resultType="int">
	<![CDATA[
		SELECT COUNT(*)
		FROM MEMBER
		WHERE TO_CHAR(M_REGDATE,'YYYYMMDD')
		BETWEEN '20181001' AND '20181031'
	]]>
	</select>
	<!-- 멤버 관련  -->
	
	<select id="selectMemberList" parameterType="hashmap" resultType="hashmap">
	<include refid="common.pagingPre"/>
	<![CDATA[	
		SELECT
			ROW_NUMBER() OVER (ORDER BY M_NO DESC) RNUM,
			M_NO,
			M_NAME,
			M_EMAIL,
			M_BIRTH,
			M_PHONE,
			M_JOB,
			M_SEX,
			M_PHONEC
		FROM
			MEMBER
		WHERE
			M_TUTOR !='4'
	]]>
	<include refid="common.pagingPost"/>
	</select>
	<select id="selectMemberDetail" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			*
		FROM
			MEMBER
		WHERE
			M_NO = #{M_NO}
	]]>
	</select>
	<update id="updateMember" parameterType="hashmap">
	<![CDATA[
		UPDATE MEMBER
		SET 
			M_EMAIL=#{M_EMAIL},
			M_PASSWD=#{M_PASSWD},
			M_PHONE=#{M_PHONE},
			M_JOB=#{M_JOB},
			M_SEX=#{M_SEX}
				
		WHERE
			M_NO = #{M_NO}
	]]>
	</update>
	<update id="deleteMember" parameterType="hashmap">
	<![CDATA[
		UPDATE MEMBER
		SET
			M_TUTOR = '4'
		WHERE
			M_NO = #{M_NO}
	]]>
	</update>
	
	<!-- 튜터 신청 관련 -->
	<select id="selectApplyList" parameterType="hashmap" resultType="hashmap"	>
	<include refid="common.pagingPre"/>
	
	<![CDATA[
		SELECT
			ROW_NUMBER() OVER (ORDER BY T_NO DESC) RNUM,
			T_NO,
			M_NO,
			T_NICK,
			T_FINALEDU,
			T_COLLEGE,
			T_DEPT,
			T_QUALIFICATION,
			T_CNAME
		FROM
			TUTOR 
		WHERE
			T_PASS = 'P'
	]]>
	<include refid="common.pagingPost"/>
	</select>
	<update id="permitRequest" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR
		SET
			T_PASS = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="cancelRequest" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR
		SET
			T_PASS='N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<!-- 인증된 튜터 관련  -->
	<select id="selectTutorList" parameterType="hashmap" resultType="hashmap">
	<include refid="common.pagingPre"/>
	<![CDATA[
		SELECT
			ROW_NUMBER() OVER (ORDER BY T_NO DESC) RNUM,
			T_NO,
			M_NO,
			T_NICK,
			T_FINALEDU,
			T_COLLEGE,
			T_DEPT,
			T_QUALIFICATION,
			T_CNAME
		FROM
			TUTOR 
		WHERE
			T_PASS = 'Y'
			
	]]>
	<include refid="common.pagingPost"/>
	</select>
	<update id="deleteTutor" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR
		SET
			T_PASS='P'
		WHERE
		 T_NO = #{T_NO}
	]]>
	</update>
	<select id="selectTutorDetail" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			Q.T_NO,
			Q.T_FINALEDU,
	      	Q.T_CNAME,
	      	TF.TF_ORIGINPROFILE,
	      	TF.TF_STOREDPROFILE,
	      	TF.TF_SCERTORIGIN,
	      	TF.TF_SCERTSTORED,
	      	TF.TF_IDORIGINFILE,
	      	TF.TF_IDSTOREDFILE,
	      	TF.TF_SCHECK,
	      	TF.TF_IDCHECK,
	      	CF.TF_C_ORIGINFILE1,
	      	CF.TF_C_ORIGINFILE2,
	      	CF.TF_C_ORIGINFILE3,
	      	CF.TF_C_ORIGINFILE4,
	      	CF.TF_C_ORIGINFILE5,
	      	CF.TF_CCHECK1,
	      	CF.TF_CCHECK2,
	      	CF.TF_CCHECK3,
	      	CF.TF_CCHECK4,
	      	CF.TF_CCHECK5
		FROM
			TUTOR Q , TUTOR_FILE TF , TUTOR_CFILE CF
		WHERE
			 Q.T_NO=#{T_NO} AND Q.T_NO = TF.T_NO AND Q.T_NO = CF.T_NO 	
	]]>
	</select>
	<!-- TUTOR Q INNER JOIN TUTOR_FILE TF ON Q.T_NO = TF.T_NO
              		INNER JOIN TUTOR_CFILE CF ON Q.T_NO = CF.T_NO
     			 	AND Q.T_NO = #{T_NO} -->
     			 	
    <update id="permitId" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_FILE
		SET
			TF_IDCHECK = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectId" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_FILE
		SET
			TF_IDCHECK = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="permitCol" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_FILE
		SET
			TF_SCHECK = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCol" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_FILE
		SET
			TF_SCHECK = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="permitCerti1" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK1 = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCerti1" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK1 = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="permitCerti2" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK2 = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCerti2" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK2 = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>  
	<update id="permitCerti3" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK3 = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCerti3" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK3 = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>  
	<update id="permitCerti4" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK4 = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCerti4" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK4 = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>  
	<update id="permitCerti5" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK5 = 'Y'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>
	<update id="rejectCerti5" parameterType="hashmap">
	<![CDATA[
		UPDATE TUTOR_CFILE
		SET
			TF_CCHECK5 = 'N'
		WHERE
			T_NO = #{T_NO}
	]]>
	</update>  
	   			 	
	<!-- 글 카테고리 관련 -->
	<select id="selectCategoryList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			CA_NO,
			CA_LSECTION,
			CA_SSECTION,
			CA_IDX
		FROM
			CATEGORY
		WHERE
			CA_DEL = 'N' ORDER BY CA_NO ASC
		
	]]>
	</select>
	<!-- 카테고리 입력시 가져오는 가증 큰 번호들 -->
	<select id="selectOneMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'1-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectTwoMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'2-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectThreeMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'3-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectFourMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'4-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<!-- <select id="selectFiveMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'5-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectSixMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'6-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectSevenMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'7-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select>
	<select id="selectEightMaxValue" resultType="string">
		<![CDATA[
			SELECT
				CA_NO
			FROM 
    			(SELECT CA_NO
      			 FROM CATEGORY
      			 WHERE CA_NO LIKE'8-%' ORDER BY CA_NO desc )
			WHERE ROWNUM = 1
		]]>
	</select> -->
	<insert id="insertCategory" parameterType="hashmap" >
	<![CDATA[
		INSERT INTO CATEGORY
		(
			CA_IDX,
			CA_NO,
			CA_LSECTION,
			CA_SSECTION,
			CA_DEL
		)
		VALUES
		(
			CA_NO_SEQ.NEXTVAL,
			#{CA_NO},
			#{CA_LSECTION},
			#{CA_SSECTION},
			'N'
		)
	]]>
	</insert>
	<select id="selectCategoryDetail" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			CA_LSECTION, CA_SSECTION, CA_IDX
		FROM
			CATEGORY
		WHERE
			CA_IDX = #{CA_IDX,jdbcType=INTEGER}
	]]>
	</select>
	<update id="deleteCategory" parameterType="hashmap">
	<![CDATA[
		UPDATE CATEGORY
			SET CA_DEL = 'Y'
			WHERE CA_IDX = #{CA_IDX}
	
	]]>
	</update>
	<update id="updateLectureChk" parameterType="hashmap">
	<![CDATA[
		UPDATE L_OPEN
			SET L_CHK = 'Y'
			WHERE CA_IDX = #{CA_IDX}
		
	]]>
	
	</update>
	<update id="modifyCategory" parameterType="hashmap">
	<![CDATA[
		UPDATE CATEGORY
			SET CA_NO = #{CA_NO},
			CA_SSECTION = #{CA_SSECTION},
			CA_LSECTION = #{CA_LSECTION}
				
		WHERE CA_IDX = #{CA_IDX}
	]]>
	</update>

	<!-- 강의 관련 -->
	<select id="selectLectureList" parameterType="hashmap" resultType="hashmap">
	<include refid="common.pagingPre"/>
	<![CDATA[	
		SELECT
			ROW_NUMBER() OVER (ORDER BY L_NO DESC) RNUM,
			L_NO,
			M_NO,
			L_SUBJECT,
			L_PRICEPH,
			L_TIMEPL,
			L_COUNTPM
		FROM
			L_OPEN
		WHERE
			L_CHK='N'
	]]>
	<include refid="common.pagingPost"/>
	</select>
	
	<update id="updateLecture" parameterType="hashmap">
	<![CDATA[
		UPDATE CATEGORY
			SET CA_DEL = 'Y'
			WHERE CA_NO = #{CA_NO}
	
	]]>
	</update>
	<!-- 파일 관련 손을 더 봐야한다. -->
	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				LF_NO,
				LF_CURRI_ORIGINFILE,
				LF_COVER_ORIGINFILE,
				LF_STUDY_ORIGINFILE
			FROM
				L_OPEN_FILE
			WHERE
				LF_NO = #{LF_NO}
		]]>
	</select>
	<insert id="insertFile" parameterType="hashmap">
	<![CDATA[
		INSERT INTO L_OPEN_FILE
		(
			LF_NO,
			L_NO,
			LF_CURRI_ORIGINALFILE,
			LF_CURRI_STOREDFILE,
			LF_COVER_ORIGINALFILE,
			LF_COVER_STOREDFILE,
			LF_STUDY_ORIGINALFILE,
			LF_STUDY_STOREDFILE
		)
		VALUES
		(
			SEQ_LF_NO.NEXTVAL,
			#{L_NO},
			#{LF_CURRI_ORIGINALFILE},
			#{LF_CURRI_STOREDFILE},
			#{LF_COVER_ORIGINALFILE},
			#{LF_COVER_STOREDFILE},
			#{LF_STUDY_ORIGINALFILE},
			#{LF_STUDY_STOREDFILE}
		)
	]]>
	</insert>
	<update id="updateFile" parameterType="hashmap">
	<![CDATA[
		UPDATE L_OPEN_FILE
			
		WHERE
			LF_NO = #{LF_NO}
	]]>
	</update>
	<select id="selectOneReserve" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			select * from L_OPEN
			WHERE L_NO = '46'
		]]>
	</select>
	<select id="selectRequestName" resultType="String">
		<![CDATA[
			SELECT NAME
			FROM L_OPEN 	
			WHERE
				L_NO = (
						SELECT L_NO
						FROM REQUEST
						WHERE R_NO=#{R_NO}
					    )
				
		]]>
	</select>
	
	<insert id="insertPayInfo" parameterType="hashmap" >
	<selectKey keyProperty="O_IDX" resultType="string" order="BEFORE">
      SELECT KO_NO_SEQ.NEXTVAL FROM DUAL
   </selectKey>
	<![CDATA[
		INSERT INTO KAKAOORDER
		(
			O_IDX,
 			O_TID,
			O_CID,
			O_STATUS,
			O_PARTNER_ID,
			O_PARTNER_USER_ID,
			O_PAYMENT_METHOD_TYPE,
			O_ITEM_NAME,
			O_QUANTITY,
			O_AMOUNT_TOTAL,
			O_AMOUNT_VAT,
			O_CANCELAVAILABLE_TOTAL,
			O_CANCELAVAILABLE_VAT,
			O_CREATED_AT,
			O_CARD_BIN,
			O_CARD_CORP_NAME,
			O_INSTALL_MONTH,
			L_NO,
			O_PG_TOKEN
		)
		VALUES
		(
			#{O_IDX},
 			#{O_TID},
			#{O_CID},
			#{O_STATUS},
			#{O_PARTNER_ID},
			#{O_PARTNER_USER_ID},
			#{O_PAYMENT_METHOD_TYPE},
			#{O_ITEM_NAME},
			#{O_QUANTITY},
			#{O_AMOUNT_TOTAL},
			#{O_AMOUNT_VAT},
			#{O_CANCELAVAILABLE_TOTAL},
			#{O_CANCELAVAILABLE_VAT},
			#{O_CREATED_AT},
			#{O_CARD_BIN},
			#{O_CARD_CORP_NAME},
			#{O_INSTALL_MONTH},
			#{L_NO},
			#{O_PG_TOKEN}
		)
	]]>
	</insert>
</mapper>