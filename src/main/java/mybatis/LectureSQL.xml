<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lecture">
	

	<!-- 뭐가 맞는걸까  카테고리별 검색 
	<select id="selectLectureCategory" parameterType="hashmap" resultType="hashMap">
	<![CDATA[
	SELECT 
   		DISTINCT S.CA_NO,R.REGIONL, R.REGIONS , R.REGIONS, S.CA_LSECTION, S.CA_SSECTION, S.CA_DEL, S.CA_IDX
	FROM 
    	CATEGORY S, (SELECT DISTINCT REGIONL, REGIONS FROM REGIONCATEGORY) R ORDER BY S.CA_NO
	]]>
	</select>
	
	카테고리별 검색
	<select id="selectLectureCategory" parameterType="hashmap" resultType="hashMap">
	<![CDATA[
	select 
		S.CA_NO, REGIONL, REGIONS , S.CA_LSECTION, S.CA_SSECTION, S.CA_DEL, S.CA_IDX, L.CA_IDX from l_open L,
	(SELECT 
  		DISTINCT CA_NO, REGIONL, REGIONS , CA_LSECTION, CA_SSECTION, CA_DEL, CA_IDX
	FROM 
   		(select  * from CATEGORY), (SELECT DISTINCT REGIONL, REGIONS FROM REGIONCATEGORY) ORDER BY CA_NO
	) S
	WHERE L.CA_IDX = S.CA_IDX
	]]>
	</select> -->
	
	
	<!-- 
   <select id="selectLectureCategory1" parameterType="hashmap" resultType="hashMap">
   <![CDATA[
   SELECT 
         DISTINCT S.CA_NO,R.REGIONL, R.REGIONS , R.REGIONS, S.CA_LSECTION, S.CA_SSECTION, S.CA_DEL, S.CA_IDX
   FROM 
       CATEGORY S, (SELECT DISTINCT REGIONL, REGIONS FROM REGIONCATEGORY) R ORDER BY S.CA_NO
   ]]>
   </select>

 
 
 	
 	
   <select id="selectProgreamCategory" parameterType="hashmap" resultType="hashMap">
   <choose>
   	<when test = "select == 1">
   	 
   <![CDATA[
     	 SELECT 
     	S.CA_NO, REGIONL, REGIONS , S.CA_LSECTION, S.CA_SSECTION, S.CA_DEL, S.CA_IDX, L.CA_IDX from l_open L,
   (SELECT 
        DISTINCT CA_NO, REGIONL, REGIONS , CA_LSECTION, CA_SSECTION, CA_DEL, CA_IDX
   FROM 
         (select  * from CATEGORY), (SELECT DISTINCT REGIONL, REGIONS FROM REGIONCATEGORY) ORDER BY CA_NO
   ) S
   WHERE L.CA_IDX = S.CA_IDX AND CA_LSECTION LIKE '1-%'
   ]]>
   	</when>
   </choose>
   </select> 
   -->
     
<select id="selectRegionNotChoiceLecture" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
	select ll_location, l_no
	from l_location
	where l_no =(select l_no from l_open
				 where ca_idx = (select ca_idx 
                 				 from category 
               					 where ca_no like '#{no}%' or ca_no=#{ca_no}
               					 )
               	)
	]]>
   </select>
   
   
   <!-- ca_no like '#{no}%' 안되면 GROUP 을 추가해서 #{ca_no} 값 집어넣으면 된다. -->
   
   
	<!-- select lecturelist -->
	<select id="lectureList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				L_NO,
				M_NO,
				L_SUBJECT,
				CA_NO,
				L_CLASSTYPE,
				L_DESCRIBE_T,
				L_DESCRIBE_L,
				L_DESCRIBE_TARGET,
				L_CURRI_TEXT,
				L_CURRI_COUNT,
				L_PRICEPH,
				L_TIMEPL,
				L_COUNTPM,
				L_TOTALPRICE,
				L_READHIT,
				L_REGDATE
			FROM
				L_OPEN
			ORDER BY L_NO DESC
		]]>
	</select>
	
	<select id="selectLectureDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				L_NO,
				M_NO,
				L_SUBJECT,
				CA_NO,
				L_CLASSTYPE,
				L_DESCRIBE_T,
				L_DESCRIBE_L,
				L_DESCRIBE_TARGET,
				L_CURRI_TEXT,
				L_CURRI_COUNT,
				L_PRICEPH,
				L_TIMEPL,
				L_COUNTPM,
				L_TOTALPRICE,
				L_READHIT,
				L_REGDATE
			FROM
				L_OPEN
			WHERE
				L_NO=#{L_NO} 
		]]>
		
	</select>
	<insert id="insertLecture" parameterType="hashmap" useGeneratedKeys="true" keyProperty="L_NO">
		<selectKey keyProperty="L_NO" resultType="string" order="BEFORE">
			SELECT L_NO_SEQ.IDX.NEXTVAL FROM DUAL
		</selectKey>
		<![CDATA[
			INSERT INTO L_OPEN
			(
				L_NO,
				M_NO,
				L_SUBJECT,
				CA_NO,
				L_CLASSTYPE,
				L_URL,
				L_DESCRIBE_T,
				L_DESCRIBE_L,
				L_DESCRIBE_TARGET,
				L_CURRI_TEXT,
				L_CURRI_COUNT,
				L_PRICEPH,
				L_TIMEPL,
				L_COUNTPM,
				L_TOTALPRICE,
				L_REGDATE
			)
			VALUES
			(
				#{L_NO},
				#{M_NO},
				#{L_SUBJECT},
				#{CA_NO},
				#{L_CLASSTYPE},
				#{L_URL},
				#{L_DESCRIBE_T},
				#{L_DESCRIBE_L},
				#{L_DESCRIBE_TARGET},
				#{L_CURRI_TEXT},
				#{L_CURRI_COUNT},
				#{L_PRICEPH},
				#{L_TIMEPL},
				#{L_COUNTPM},
				#{L_TOTALPRICE},
				#{L_REGDATE}
			)
				 
		]]>
	</insert>
		
	<update id="updatelectureHitCnt" parameterType="hashmap">
		<![CDATA[
			UPDATE L_OPEN
			SET
				L_READHIT = NVL(L_READHIT,0)+1
			WHERE
				L_NO=#{L_NO}
		]]>
	</update>
	
	<update id="updateLecture" parameterType="hashmap">
		<![CDATA[
			UPDATE L_OPEN
			SET
				L_SUBJECT=#{L_SUBJECT},
				CA_NO=#{CA_NO},
				L_URL=#{L_URL},
				L_DESCRIBE_T=#{L_DESCRIBE_T},
				L_DESCRIBE_L=#{L_DESCRIBE_L},
				L_DESCRIBE_TARGET=#{L_DESCRIBE_TARGET},
				L_CURRI_TEXT=#{L_CURRI_TEXT},
				L_CURRI_COUNT=#{L_CURRI_COUNT},
				L_PRICEPH=#{L_PRICEPH},
				L_TIMEPL=#{L_TIMEPL},
				L_COUNTPM=#{L_COUNTPM},
				L_TOTLAPRICE=#{L_TOTALPRICE},
			WHERE
				L_NO=#{L_NO}
		]]>
	</update>
	
	<update id="deleteLecture" parameterType="hashmap">
		<![CDATA[
			UPDATE L_OPEN
			SET
				L_SUBJECT='DEL'
			WHERE
				L_NO=#{L_NO}
		]]>
	</update>
	
</mapper> 